# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Firebase ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

## ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á Firebase?

Firebase ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Backend-as-a-Service ‡∏Ç‡∏≠‡∏á Google ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
- ‚úÖ **‡∏ü‡∏£‡∏µ** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö usage ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å-‡∏Å‡∏•‡∏≤‡∏á (1GB storage, 50K reads/day)
- ‚úÖ **‡∏á‡πà‡∏≤‡∏¢** ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 10 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‚úÖ **Real-time** ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö instant
- ‚úÖ **No Backend** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô server code

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Firebase

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà [Firebase Console](https://console.firebase.google.com/)
2. ‡∏Ñ‡∏•‡∏¥‡∏Å "Add project" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ"
3. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô "high-spirited-child-book"
4. ‡∏õ‡∏¥‡∏î Google Analytics (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
5. ‡∏Ñ‡∏•‡∏¥‡∏Å "Create project"

### 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firestore Database

1. ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢ ‡∏Ñ‡∏•‡∏¥‡∏Å **Build > Firestore Database**
2. ‡∏Ñ‡∏•‡∏¥‡∏Å "Create database"
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **Start in test mode** (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏í‡∏ô‡∏≤)
4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å region ‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (asia-southeast1 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢)

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏° Firebase ‡πÉ‡∏ô Web App

1. ‡πÉ‡∏ô Project Overview ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Web `</>`
2. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ app
3. Copy config object ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ

---

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô React

### ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Package

```bash
npm install firebase
```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Config

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `src/firebase.js`:

```javascript
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
export const db = getFirestore(app);
```

> ‚ö†Ô∏è **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ environment variables

---

## ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó ChapterRating.jsx

‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó component ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Firebase ‡πÅ‡∏ó‡∏ô localStorage:

```jsx
import { useState, useEffect } from 'react';
import { doc, getDoc, setDoc, increment, runTransaction } from 'firebase/firestore';
import { db } from '../firebase';

const getDocId = (chapterId) => `chapter-${chapterId}`;

export default function ChapterRating({ chapterId, chapterTitle }) {
    const [rating, setRating] = useState(0);
    const [userRating, setUserRating] = useState(0);
    const [totalRatings, setTotalRatings] = useState(0);
    const [views, setViews] = useState(0);
    const [hoveredStar, setHoveredStar] = useState(0);
    const [hasRated, setHasRated] = useState(false);
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
        const docId = getDocId(chapterId);
        const userRatingKey = `user-rating-${chapterId}`;
        
        const loadDataAndIncrementViews = async () => {
            setIsLoading(true);
            try {
                const docRef = doc(db, 'chapters', docId);
                
                // Increment view count
                await runTransaction(db, async (transaction) => {
                    const docSnap = await transaction.get(docRef);
                    if (docSnap.exists()) {
                        transaction.update(docRef, {
                            views: increment(1)
                        });
                    } else {
                        transaction.set(docRef, {
                            views: 1,
                            totalScore: 0,
                            totalRatings: 0,
                            averageRating: 0
                        });
                    }
                });

                // Get updated data
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    setViews(data.views || 0);
                    setRating(data.averageRating || 0);
                    setTotalRatings(data.totalRatings || 0);
                }

                // Check if user already rated (stored locally)
                const savedUserRating = localStorage.getItem(userRatingKey);
                if (savedUserRating) {
                    setUserRating(parseInt(savedUserRating, 10));
                    setHasRated(true);
                }
            } catch (error) {
                console.error('Error loading data:', error);
            } finally {
                setIsLoading(false);
            }
        };

        loadDataAndIncrementViews();
    }, [chapterId]);

    const handleRate = async (newRating) => {
        if (hasRated) return;

        const docId = getDocId(chapterId);
        const userRatingKey = `user-rating-${chapterId}`;
        
        try {
            const docRef = doc(db, 'chapters', docId);
            
            await runTransaction(db, async (transaction) => {
                const docSnap = await transaction.get(docRef);
                const data = docSnap.exists() ? docSnap.data() : { totalScore: 0, totalRatings: 0 };
                
                const newTotalScore = (data.totalScore || 0) + newRating;
                const newTotalRatings = (data.totalRatings || 0) + 1;
                const newAverageRating = newTotalScore / newTotalRatings;
                
                transaction.update(docRef, {
                    totalScore: newTotalScore,
                    totalRatings: newTotalRatings,
                    averageRating: newAverageRating
                });
                
                setRating(newAverageRating);
                setTotalRatings(newTotalRatings);
            });

            // Save user rating locally
            localStorage.setItem(userRatingKey, newRating.toString());
            setUserRating(newRating);
            setHasRated(true);
        } catch (error) {
            console.error('Error saving rating:', error);
        }
    };

    // ... rest of the component remains the same
};
```

---

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore

```
chapters (collection)
  ‚îî‚îÄ‚îÄ chapter-introduction (document)
        ‚îú‚îÄ‚îÄ views: 1234
        ‚îú‚îÄ‚îÄ totalScore: 4320
        ‚îú‚îÄ‚îÄ totalRatings: 1000
        ‚îî‚îÄ‚îÄ averageRating: 4.32
  ‚îî‚îÄ‚îÄ chapter-1 (document)
        ‚îî‚îÄ‚îÄ ...
```

---

## Security Rules (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production)

‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firestore > Rules ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /chapters/{chapterId} {
      // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
      allow read: if true;
      
      // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° views ‡πÅ‡∏•‡∏∞ rating
      allow update: if request.resource.data.diff(resource.data).affectedKeys()
                      .hasOnly(['views', 'totalScore', 'totalRatings', 'averageRating']);
      
      // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á document ‡πÉ‡∏´‡∏°‡πà
      allow create: if true;
    }
  }
}
```

---

## ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ

| Service | ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ | ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢ |
|---------|-------|---------|
| **Firebase** | ‡∏ü‡∏£‡∏µ, ‡∏á‡πà‡∏≤‡∏¢, Real-time | ‡∏ï‡πâ‡∏≠‡∏á Google account |
| **Supabase** | Open source, PostgreSQL | ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤ |
| **PlanetScale** | MySQL, Generous free tier | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL |
| **MongoDB Atlas** | Flexible schema | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ MongoDB |

---

## ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥

1. [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á Firebase project
2. [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firestore Database  
3. [ ] ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á firebase package
4. [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `src/firebase.js` 
5. [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó `ChapterRating.jsx`
6. [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
7. [ ] ‡∏ï‡∏±‡πâ‡∏á Security Rules ‡∏Å‡πà‡∏≠‡∏ô deploy

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢ implement ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡∏ö‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! üöÄ
